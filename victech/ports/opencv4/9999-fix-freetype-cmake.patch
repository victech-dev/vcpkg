From 02c271459798d5a694dc5638ee5583b184cf7191 Mon Sep 17 00:00:00 2001
From: sehee <sehee>
Date: Mon, 9 Nov 2020 14:22:44 +0900
Subject: [PATCH] fix freetype cmake

---
 modules/freetype/CMakeLists.txt | 28 +++++++++++++++++++---------
 1 file changed, 19 insertions(+), 9 deletions(-)

diff --git a/modules/freetype/CMakeLists.txt b/modules/freetype/CMakeLists.txt
index 6dd4aaf..f5aec6e 100644
--- a/modules/freetype/CMakeLists.txt
+++ b/modules/freetype/CMakeLists.txt
@@ -3,26 +3,36 @@ if(APPLE_FRAMEWORK)
   ocv_module_disable(freetype)
 endif()
 
-ocv_check_modules(FREETYPE freetype2)
-ocv_check_modules(HARFBUZZ harfbuzz)
+#ocv_check_modules(FREETYPE freetype2)
+#ocv_check_modules(HARFBUZZ harfbuzz)
+find_package(freetype CONFIG QUIET)
+find_package(harfbuzz CONFIG QUIET)
+if (freetype_FOUND AND harfbuzz_FOUND)
+  get_target_property(FREETYPE_INCLUDE_DIRS freetype INTERFACE_INCLUDE_DIRECTORIES)
+  get_target_property(HARFBUZZ_INCLUDE_DIRS harfbuzz::harfbuzz INTERFACE_INCLUDE_DIRECTORIES)
+  get_target_property(_freetype_FOUND_DIR freetype IMPORTED_LOCATION_RELEASE)
+  get_filename_component(_freetype_FOUND_DIR ${_freetype_FOUND_DIR} PATH)
+  get_target_property(_harfbuzz_FOUND_DIR harfbuzz::harfbuzz IMPORTED_LOCATION_RELEASE)
+  get_filename_component(_harfbuzz_FOUND_DIR ${_harfbuzz_FOUND_DIR} PATH)
+endif()
 
 if(OPENCV_INITIAL_PASS)
-  if(NOT FREETYPE_FOUND)
-    message(STATUS "freetype2:   NO")
+  if(NOT freetype_FOUND)
+    message(STATUS "freetype:   NO")
   else()
-    message(STATUS "freetype2:   YES (ver ${FREETYPE_VERSION})")
+    message(STATUS "freetype:   YES (${_freetype_FOUND_DIR})")
   endif()
 
-  if(NOT HARFBUZZ_FOUND)
+  if(NOT harfbuzz_FOUND)
     message(STATUS "harfbuzz:    NO")
   else()
-    message(STATUS "harfbuzz:    YES (ver ${HARFBUZZ_VERSION})")
+    message(STATUS "harfbuzz:    YES (${_harfbuzz_FOUND_DIR})")
   endif()
 endif()
 
-if(FREETYPE_FOUND AND HARFBUZZ_FOUND)
+if(freetype_FOUND AND harfbuzz_FOUND)
   ocv_define_module(freetype opencv_core opencv_imgproc WRAP python)
-  ocv_target_link_libraries(${the_module} ${FREETYPE_LIBRARIES} ${HARFBUZZ_LIBRARIES})
+  ocv_target_link_libraries(${the_module} freetype harfbuzz::harfbuzz)
   ocv_include_directories( ${FREETYPE_INCLUDE_DIRS} ${HARFBUZZ_INCLUDE_DIRS} )
 else()
   ocv_module_disable(freetype)
-- 
2.17.1

